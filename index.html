<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„ÙØªØ§ÙˆÙ‰ Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Naskh Arabic', 'Amiri', serif;
            background-color: #f8f5f0;
            color: #2c3e50;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1a5f4a 0%, #0d3d30 100%);
            padding: 24px 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L60 30L30 60L0 30L30 0z' fill='%23ffffff' fill-opacity='0.05'/%3E%3C/svg%3E");
            background-size: 30px 30px;
        }
        
        .header h1 {
            color: #fff;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            color: #d4af37;
            font-size: 14px;
            position: relative;
        }
        
        .bismillah {
            color: #fff;
            font-size: 18px;
            margin-top: 16px;
            opacity: 0.9;
            position: relative;
        }
        
        .main {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .input-section {
            background-color: #fff;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .input-section label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #1a5f4a;
        }
        
        .input-section textarea {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            resize: none;
            font-family: inherit;
            direction: rtl;
            transition: border-color 0.3s;
            outline: none;
        }
        
        .input-section textarea:focus {
            border-color: #1a5f4a;
        }
        
        .btn {
            width: 100%;
            padding: 14px 24px;
            font-size: 18px;
            font-weight: bold;
            background-color: #1a5f4a;
            color: #fff;
            border: none;
            border-radius: 12px;
            margin-top: 12px;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(26,95,74,0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(26,95,74,0.4);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .error {
            background-color: #fff5f5;
            color: #c53030;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            display: none;
            align-items: center;
            gap: 8px;
            border: 1px solid #feb2b2;
        }
        
        .question-display {
            background-color: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-right: 4px solid #d4af37;
        }
        
        .question-display .icon {
            font-size: 24px;
        }
        
        .question-display .text {
            font-size: 16px;
            line-height: 1.8;
        }
        
        .madhhab-card {
            background-color: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid;
            margin-bottom: 16px;
        }
        
        .madhhab-header {
            padding: 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .madhhab-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .madhhab-icon {
            font-size: 28px;
        }
        
        .madhhab-name {
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        
        .founder-name {
            color: rgba(255,255,255,0.8);
            font-size: 12px;
            margin: 4px 0 0 0;
        }
        
        .expand-icon {
            color: #fff;
            font-size: 14px;
            transition: transform 0.3s;
        }
        
        .ruling-badge {
            padding: 12px 16px;
            border-bottom: 2px solid;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .ruling-label {
            font-size: 14px;
            color: #666;
        }
        
        .ruling-text {
            font-size: 16px;
            font-weight: bold;
        }
        
        .expanded-content {
            padding: 16px;
            display: none;
        }
        
        .expanded-content.show {
            display: block;
        }
        
        .section {
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 15px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .section-text {
            font-size: 15px;
            line-height: 1.9;
            color: #4a5568;
        }
        
        .evidence-box {
            padding: 14px;
            border-radius: 10px;
            border-right: 4px solid;
        }
        
        .evidence-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .evidence-text {
            font-size: 14px;
            line-height: 1.8;
            color: #4a5568;
            font-style: italic;
        }
        
        .consensus-box {
            background-color: #e8f5e9;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            border-right: 4px solid #4caf50;
        }
        
        .consensus-title {
            font-size: 16px;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 8px;
        }
        
        .consensus-text {
            font-size: 15px;
            line-height: 1.8;
            color: #4a5568;
        }
        
        .note-box {
            background-color: #fff8e1;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            border-right: 4px solid #ffc107;
        }
        
        .note-title {
            font-size: 16px;
            font-weight: bold;
            color: #f57c00;
            margin-bottom: 8px;
        }
        
        .note-text {
            font-size: 15px;
            line-height: 1.8;
            color: #4a5568;
        }
        
        .disclaimer {
            background-color: #fafafa;
            border-radius: 10px;
            padding: 14px;
            margin-top: 24px;
            text-align: center;
            font-size: 13px;
            color: #718096;
            border: 1px dashed #cbd5e0;
        }
        
        .footer {
            background-color: #1a5f4a;
            color: rgba(255,255,255,0.8);
            text-align: center;
            padding: 16px;
            font-size: 14px;
            margin-top: 24px;
        }
        
        /* Madhhab Colors */
        .hanafi { border-color: #1a5f4a; }
        .hanafi .madhhab-header { background-color: #1a5f4a; }
        .hanafi .ruling-badge { background-color: #e8f5f1; border-color: #2d8a6e; }
        .hanafi .ruling-text { color: #1a5f4a; }
        .hanafi .evidence-box { background-color: #e8f5f1; border-right-color: #1a5f4a; }
        
        .maliki { border-color: #8b4513; }
        .maliki .madhhab-header { background-color: #8b4513; }
        .maliki .ruling-badge { background-color: #fdf5e6; border-color: #a0522d; }
        .maliki .ruling-text { color: #8b4513; }
        .maliki .evidence-box { background-color: #fdf5e6; border-right-color: #8b4513; }
        
        .shafii { border-color: #1e3a5f; }
        .shafii .madhhab-header { background-color: #1e3a5f; }
        .shafii .ruling-badge { background-color: #e8f0f8; border-color: #2c5282; }
        .shafii .ruling-text { color: #1e3a5f; }
        .shafii .evidence-box { background-color: #e8f0f8; border-right-color: #1e3a5f; }
        
        .hanbali { border-color: #5c4033; }
        .hanbali .madhhab-header { background-color: #5c4033; }
        .hanbali .ruling-badge { background-color: #f5efe8; border-color: #7a5a45; }
        .hanbali .ruling-text { color: #5c4033; }
        .hanbali .evidence-box { background-color: #f5efe8; border-right-color: #5c4033; }
        
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .results-section {
            display: none;
        }
        
        .results-section.show {
            display: block;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Ø§Ù„ÙØªØ§ÙˆÙ‰ Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</h1>
        <p class="subtitle">Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø³Ù†ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©</p>
        <div class="bismillah">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
    </header>

    <main class="main">
        <div class="input-section">
            <label>Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ø´Ø±Ø¹ÙŠ</label>
            <textarea id="question" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§ Ø­ÙƒÙ… ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø©ØŸ Ø£Ùˆ Ù…Ø§ Ù‡ÙŠ Ø´Ø±ÙˆØ· Ø§Ù„Ø²ÙƒØ§Ø©ØŸ" rows="4"></textarea>
            <button class="btn" id="askBtn" onclick="askFatwa()">ğŸ” Ø§Ø³ØªÙØªÙ</button>
        </div>

        <div class="error" id="error">
            <span>âš ï¸</span> <span id="errorText"></span>
        </div>

        <div class="results-section" id="results">
            <div class="question-display">
                <span class="icon">â“</span>
                <span class="text" id="questionText"></span>
            </div>

            <!-- Hanafi -->
            <div class="madhhab-card hanafi">
                <div class="madhhab-header" onclick="toggleMadhhab('hanafi')">
                    <div class="madhhab-title-row">
                        <span class="madhhab-icon">ğŸ•Œ</span>
                        <div>
                            <h3 class="madhhab-name">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø­Ù†ÙÙŠ</h3>
                            <p class="founder-name">Ø§Ù„Ø¥Ù…Ø§Ù… Ø£Ø¨Ùˆ Ø­Ù†ÙŠÙØ© Ø§Ù„Ù†Ø¹Ù…Ø§Ù†</p>
                        </div>
                    </div>
                    <span class="expand-icon" id="hanafi-icon">â–¼</span>
                </div>
                <div class="ruling-badge">
                    <span class="ruling-label">Ø§Ù„Ø­ÙƒÙ…:</span>
                    <span class="ruling-text" id="hanafi-ruling"></span>
                </div>
                <div class="expanded-content" id="hanafi-content">
                    <div class="section">
                        <h4 class="section-title">ğŸ“œ Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„</h4>
                        <p class="section-text" id="hanafi-explanation"></p>
                    </div>
                    <div class="evidence-box">
                        <h4 class="evidence-title">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„</h4>
                        <p class="evidence-text" id="hanafi-evidence"></p>
                    </div>
                </div>
            </div>

            <!-- Maliki -->
            <div class="madhhab-card maliki">
                <div class="madhhab-header" onclick="toggleMadhhab('maliki')">
                    <div class="madhhab-title-row">
                        <span class="madhhab-icon">ğŸ“¿</span>
                        <div>
                            <h3 class="madhhab-name">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ</h3>
                            <p class="founder-name">Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø§Ù„Ùƒ Ø¨Ù† Ø£Ù†Ø³</p>
                        </div>
                    </div>
                    <span class="expand-icon" id="maliki-icon">â–¼</span>
                </div>
                <div class="ruling-badge">
                    <span class="ruling-label">Ø§Ù„Ø­ÙƒÙ…:</span>
                    <span class="ruling-text" id="maliki-ruling"></span>
                </div>
                <div class="expanded-content" id="maliki-content">
                    <div class="section">
                        <h4 class="section-title">ğŸ“œ Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„</h4>
                        <p class="section-text" id="maliki-explanation"></p>
                    </div>
                    <div class="evidence-box">
                        <h4 class="evidence-title">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„</h4>
                        <p class="evidence-text" id="maliki-evidence"></p>
                    </div>
                </div>
            </div>

            <!-- Shafii -->
            <div class="madhhab-card shafii">
                <div class="madhhab-header" onclick="toggleMadhhab('shafii')">
                    <div class="madhhab-title-row">
                        <span class="madhhab-icon">ğŸ“–</span>
                        <div>
                            <h3 class="madhhab-name">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</h3>
                            <p class="founder-name">Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¥Ø¯Ø±ÙŠØ³ Ø§Ù„Ø´Ø§ÙØ¹ÙŠ</p>
                        </div>
                    </div>
                    <span class="expand-icon" id="shafii-icon">â–¼</span>
                </div>
                <div class="ruling-badge">
                    <span class="ruling-label">Ø§Ù„Ø­ÙƒÙ…:</span>
                    <span class="ruling-text" id="shafii-ruling"></span>
                </div>
                <div class="expanded-content" id="shafii-content">
                    <div class="section">
                        <h4 class="section-title">ğŸ“œ Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„</h4>
                        <p class="section-text" id="shafii-explanation"></p>
                    </div>
                    <div class="evidence-box">
                        <h4 class="evidence-title">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„</h4>
                        <p class="evidence-text" id="shafii-evidence"></p>
                    </div>
                </div>
            </div>

            <!-- Hanbali -->
            <div class="madhhab-card hanbali">
                <div class="madhhab-header" onclick="toggleMadhhab('hanbali')">
                    <div class="madhhab-title-row">
                        <span class="madhhab-icon">ğŸŒ™</span>
                        <div>
                            <h3 class="madhhab-name">Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø­Ù†Ø¨Ù„ÙŠ</h3>
                            <p class="founder-name">Ø§Ù„Ø¥Ù…Ø§Ù… Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø­Ù†Ø¨Ù„</p>
                        </div>
                    </div>
                    <span class="expand-icon" id="hanbali-icon">â–¼</span>
                </div>
                <div class="ruling-badge">
                    <span class="ruling-label">Ø§Ù„Ø­ÙƒÙ…:</span>
                    <span class="ruling-text" id="hanbali-ruling"></span>
                </div>
                <div class="expanded-content" id="hanbali-content">
                    <div class="section">
                        <h4 class="section-title">ğŸ“œ Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„</h4>
                        <p class="section-text" id="hanbali-explanation"></p>
                    </div>
                    <div class="evidence-box">
                        <h4 class="evidence-title">ğŸ“– Ø§Ù„Ø¯Ù„ÙŠÙ„</h4>
                        <p class="evidence-text" id="hanbali-evidence"></p>
                    </div>
                </div>
            </div>

            <div class="consensus-box" id="consensus-box">
                <h3 class="consensus-title">ğŸ¤ Ù†Ù‚Ø§Ø· Ø§Ù„Ø§ØªÙØ§Ù‚</h3>
                <p class="consensus-text" id="consensus-text"></p>
            </div>

            <div class="note-box" id="note-box">
                <h3 class="note-title">ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
                <p class="note-text" id="note-text"></p>
            </div>
        </div>

        <div class="disclaimer">
            <p>âš ï¸ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·. Ù„Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø§ØµØ©ØŒ ÙŠÙØ±Ø¬Ù‰ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø£Ù‡Ù„ Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ†.</p>
        </div>
    </main>

    <footer class="footer">
        <p>ÙˆÙÙ…ÙØ§ Ø£ÙÙˆØªÙÙŠØªÙÙ… Ù…ÙÙ‘Ù†Ù Ø§Ù„Ù’Ø¹ÙÙ„Ù’Ù…Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‚ÙÙ„ÙÙŠÙ„Ù‹Ø§</p>
    </footer>

    <script>
        let expandedMadhhab = null;

        function toggleMadhhab(madhhab) {
            const content = document.getElementById(madhhab + '-content');
            const icon = document.getElementById(madhhab + '-icon');
            
            if (expandedMadhhab === madhhab) {
                content.classList.remove('show');
                icon.textContent = 'â–¼';
                expandedMadhhab = null;
            } else {
                // Close previously expanded
                if (expandedMadhhab) {
                    document.getElementById(expandedMadhhab + '-content').classList.remove('show');
                    document.getElementById(expandedMadhhab + '-icon').textContent = 'â–¼';
                }
                content.classList.add('show');
                icon.textContent = 'â–²';
                expandedMadhhab = madhhab;
            }
        }

        async function askFatwa() {
            const question = document.getElementById('question').value.trim();
            const btn = document.getElementById('askBtn');
            const error = document.getElementById('error');
            const results = document.getElementById('results');

            if (!question) {
                error.style.display = 'flex';
                document.getElementById('errorText').textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¤Ø§Ù„Ùƒ';
                return;
            }

            error.style.display = 'none';
            results.classList.remove('show');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"><span class="spinner">â³</span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒØªØ¨ Ø§Ù„ÙÙ‚Ù‡...</span>';

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: `Ø£Ù†Øª Ø¹Ø§Ù„Ù… ÙÙ‚Ù‡ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©. Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ù…Ù† Ù…Ù†Ø¸ÙˆØ± ÙƒÙ„ Ù…Ø°Ù‡Ø¨ Ù…Ù† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø³Ù†ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©.

Ø§Ù„Ø³Ø¤Ø§Ù„: ${question}

Ø£Ø¬Ø¨ Ø¨ØµÙŠØºØ© JSON ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠØŒ Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØªØ§Ù„ÙŠ:
{
  "question": "Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø·Ø±ÙˆØ­",
  "hanafi": {
    "ruling": "Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ",
    "explanation": "Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©",
    "evidence": "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ùˆ Ø§Ù„Ø³Ù†Ø©"
  },
  "maliki": {
    "ruling": "Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ",
    "explanation": "Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©",
    "evidence": "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ùˆ Ø§Ù„Ø³Ù†Ø©"
  },
  "shafii": {
    "ruling": "Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ",
    "explanation": "Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©",
    "evidence": "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ùˆ Ø§Ù„Ø³Ù†Ø©"
  },
  "hanbali": {
    "ruling": "Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ø´Ø±Ø¹ÙŠ",
    "explanation": "Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„ØªÙØµÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù„Ø©",
    "evidence": "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ùˆ Ø§Ù„Ø³Ù†Ø©"
  },
  "consensus": "Ù†Ù‚Ø§Ø· Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø¥Ù† ÙˆØ¬Ø¯Øª",
  "note": "Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ø§Ù…Ø© Ø£Ùˆ Ù†ØµÙŠØ­Ø©"
}`
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.map(item => item.text || '').join('');
                const cleanJson = text.replace(/```json|```/g, '').trim();
                const fatwa = JSON.parse(cleanJson);

                // Update UI
                document.getElementById('questionText').textContent = fatwa.question;

                ['hanafi', 'maliki', 'shafii', 'hanbali'].forEach(m => {
                    document.getElementById(m + '-ruling').textContent = fatwa[m]?.ruling || '';
                    document.getElementById(m + '-explanation').textContent = fatwa[m]?.explanation || '';
                    document.getElementById(m + '-evidence').textContent = fatwa[m]?.evidence || '';
                });

                if (fatwa.consensus) {
                    document.getElementById('consensus-text').textContent = fatwa.consensus;
                    document.getElementById('consensus-box').style.display = 'block';
                } else {
                    document.getElementById('consensus-box').style.display = 'none';
                }

                if (fatwa.note) {
                    document.getElementById('note-text').textContent = fatwa.note;
                    document.getElementById('note-box').style.display = 'block';
                } else {
                    document.getElementById('note-box').style.display = 'none';
                }

                results.classList.add('show');
                expandedMadhhab = null;

            } catch (err) {
                error.style.display = 'flex';
                document.getElementById('errorText').textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙØªÙˆÙ‰. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ” Ø§Ø³ØªÙØªÙ';
            }
        }

        // Demo data for preview
        function loadDemoData() {
            const demoFatwa = {
                question: "Ù…Ø§ Ø­ÙƒÙ… ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ù„Ù„Ø±Ø¬Ø§Ù„ØŸ",
                hanafi: {
                    ruling: "Ø³Ù†Ø© Ù…Ø¤ÙƒØ¯Ø©",
                    explanation: "ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø³Ù†Ø© Ù…Ø¤ÙƒØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ù†ÙÙŠØ©ØŒ ÙˆÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨ ÙÙŠ Ø§Ù„ØªØ£ÙƒÙŠØ¯ØŒ ÙˆÙŠØ£Ø«Ù… ØªØ§Ø±ÙƒÙ‡Ø§ Ù…Ù† ØºÙŠØ± Ø¹Ø°Ø± Ø¥Ø«Ù…Ø§Ù‹ ÙŠØ³ÙŠØ±Ø§Ù‹. ÙˆØ§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø£ÙØ¶Ù„ Ù…Ù† ØµÙ„Ø§Ø© Ø§Ù„ÙØ±Ø¯ Ø¨Ø³Ø¨Ø¹ ÙˆØ¹Ø´Ø±ÙŠÙ† Ø¯Ø±Ø¬Ø©.",
                    evidence: "Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º: Â«ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø£ÙØ¶Ù„ Ù…Ù† ØµÙ„Ø§Ø© Ø§Ù„ÙØ° Ø¨Ø³Ø¨Ø¹ ÙˆØ¹Ø´Ø±ÙŠÙ† Ø¯Ø±Ø¬Ø©Â» Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡"
                },
                maliki: {
                    ruling: "Ø³Ù†Ø© Ù…Ø¤ÙƒØ¯Ø©",
                    explanation: "Ø§Ù„Ù…Ø§Ù„ÙƒÙŠØ© ÙŠØ±ÙˆÙ† Ø£Ù† ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø³Ù†Ø© Ù…Ø¤ÙƒØ¯Ø© Ù„Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³ØŒ ÙˆÙ‡ÙŠ Ù…Ù† Ø´Ø¹Ø§Ø¦Ø± Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©. ÙˆÙŠÙÙƒØ±Ù‡ Ù„Ù„Ø±Ø¬Ù„ Ø§Ù„Ù‚Ø§Ø¯Ø± Ø£Ù† ÙŠØªØ®Ù„Ù Ø¹Ù†Ù‡Ø§ Ø¨Ù„Ø§ Ø¹Ø°Ø±.",
                    evidence: "Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º: Â«ØµÙ„Ø§Ø© Ø§Ù„Ø±Ø¬Ù„ ÙÙŠ Ø¬Ù…Ø§Ø¹Ø© ØªØ¶Ø¹Ù Ø¹Ù„Ù‰ ØµÙ„Ø§ØªÙ‡ ÙÙŠ Ø¨ÙŠØªÙ‡ ÙˆÙÙŠ Ø³ÙˆÙ‚Ù‡ Ø®Ù…Ø³Ø§Ù‹ ÙˆØ¹Ø´Ø±ÙŠÙ† Ø¶Ø¹ÙØ§Ù‹Â» Ø±ÙˆØ§Ù‡ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"
                },
                shafii: {
                    ruling: "ÙØ±Ø¶ ÙƒÙØ§ÙŠØ©",
                    explanation: "ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© ÙØ±Ø¶ ÙƒÙØ§ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø§ÙØ¹ÙŠØ© ÙÙŠ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ø°Ù‡Ø¨ØŒ Ø¨Ø­ÙŠØ« Ø¥Ø°Ø§ Ù‚Ø§Ù… Ø¨Ù‡Ø§ Ø§Ù„Ø¨Ø¹Ø¶ Ø³Ù‚Ø· Ø§Ù„Ø¥Ø«Ù… Ø¹Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠÙ†. ÙˆÙ‡ÙŠ Ø³Ù†Ø© Ù…Ø¤ÙƒØ¯Ø© ÙÙŠ Ø­Ù‚ Ø§Ù„Ø£Ø¹ÙŠØ§Ù†.",
                    evidence: "Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰: ï´¿ÙˆÙØ£ÙÙ‚ÙÙŠÙ…ÙÙˆØ§ Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù ÙˆÙØ¢ØªÙÙˆØ§ Ø§Ù„Ø²ÙÙ‘ÙƒÙØ§Ø©Ù ÙˆÙØ§Ø±Ù’ÙƒÙØ¹ÙÙˆØ§ Ù…ÙØ¹Ù Ø§Ù„Ø±ÙÙ‘Ø§ÙƒÙØ¹ÙÙŠÙ†Ùï´¾"
                },
                hanbali: {
                    ruling: "ÙˆØ§Ø¬Ø¨Ø©",
                    explanation: "ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© ÙˆØ§Ø¬Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¬Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ù†Ø§Ø¨Ù„Ø© Ù„Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³ØŒ ÙˆÙ‡ÙŠ Ø¢ÙƒØ¯ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ÙØ±Ø§Ø¦Ø¶. ÙˆÙŠØ£Ø«Ù… Ù…Ù† ØªØ±ÙƒÙ‡Ø§ Ø¨Ù„Ø§ Ø¹Ø°Ø± Ø´Ø±Ø¹ÙŠ Ù…Ø¹ØªØ¨Ø±.",
                    evidence: "Ø­Ø¯ÙŠØ« Ø£Ø¨ÙŠ Ù‡Ø±ÙŠØ±Ø© Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡ Ø£Ù† Ø§Ù„Ù†Ø¨ÙŠ ï·º Ù‚Ø§Ù„: Â«Ù„Ù‚Ø¯ Ù‡Ù…Ù…Øª Ø£Ù† Ø¢Ù…Ø± Ø¨Ø§Ù„ØµÙ„Ø§Ø© ÙØªÙ‚Ø§Ù…ØŒ Ø«Ù… Ø¢Ù…Ø± Ø±Ø¬Ù„Ø§Ù‹ ÙÙŠØµÙ„ÙŠ Ø¨Ø§Ù„Ù†Ø§Ø³ØŒ Ø«Ù… Ø£Ù†Ø·Ù„Ù‚ Ù…Ø¹ÙŠ Ø¨Ø±Ø¬Ø§Ù„ Ù…Ø¹Ù‡Ù… Ø­Ø²Ù… Ù…Ù† Ø­Ø·Ø¨ Ø¥Ù„Ù‰ Ù‚ÙˆÙ… Ù„Ø§ ÙŠØ´Ù‡Ø¯ÙˆÙ† Ø§Ù„ØµÙ„Ø§Ø© ÙØ£Ø­Ø±Ù‚ Ø¹Ù„ÙŠÙ‡Ù… Ø¨ÙŠÙˆØªÙ‡Ù… Ø¨Ø§Ù„Ù†Ø§Ø±Â» Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡"
                },
                consensus: "Ø§ØªÙÙ‚Øª Ø§Ù„Ù…Ø°Ø§Ù‡Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø¹Ù„Ù‰ ÙØ¶Ù„ ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© ÙˆØ£Ù†Ù‡Ø§ Ù…Ù† Ø´Ø¹Ø§Ø¦Ø± Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©ØŒ ÙˆØ£Ù† ØªØ±ÙƒÙ‡Ø§ Ù…Ù† ØºÙŠØ± Ø¹Ø°Ø± Ù…Ø°Ù…ÙˆÙ… Ø´Ø±Ø¹Ø§Ù‹.",
                note: "ÙŠÙ†Ø¨ØºÙŠ Ù„Ù„Ù…Ø³Ù„Ù… Ø§Ù„Ø­Ø±Øµ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ù…Ø§ Ø§Ø³ØªØ·Ø§Ø¹ØŒ ÙÙ‡ÙŠ Ù…Ù† Ø£Ø¹Ø¸Ù… Ø´Ø¹Ø§Ø¦Ø± Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙˆØ£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø£Ù„ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ†."
            };

            document.getElementById('questionText').textContent = demoFatwa.question;
            document.getElementById('question').value = demoFatwa.question;

            ['hanafi', 'maliki', 'shafii', 'hanbali'].forEach(m => {
                document.getElementById(m + '-ruling').textContent = demoFatwa[m].ruling;
                document.getElementById(m + '-explanation').textContent = demoFatwa[m].explanation;
                document.getElementById(m + '-evidence').textContent = demoFatwa[m].evidence;
            });

            document.getElementById('consensus-text').textContent = demoFatwa.consensus;
            document.getElementById('note-text').textContent = demoFatwa.note;
            document.getElementById('results').classList.add('show');
        }

        // Load demo data on page load
        window.onload = loadDemoData;
    </script>
</body>
</html>
